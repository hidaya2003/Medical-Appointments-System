<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="users.css">
  <link rel="shortcut icon" href="icon-192.png" type="image/png">
  <style>
    .container {
      margin-right: 110px;
    }
    .sidebar .nav-item {
      margin: 8px 10px;
      padding: 10px 4px;
    } 
.container {
  margin-right: 110px;
}

/* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.action-section {
  display: flex;
  flex-direction: column;
  gap: 20px;
  margin-top: 30px;
  margin-bottom: 30px;
}

.action-box {
  background-color: #f7f7f7;
  border-radius: 16px;
  padding: 25px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.action-box h3 {
  color: #0d6efd;
  margin-bottom: 20px;
}

.button-group {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.action-box button {
  flex: 1;
  min-width: 160px;
  padding: 10px 16px;
  background-color: #0d6efd;
  color: #f7f7f7;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 17px;
  transition: background 0.3s ease;
}

.action-box button:hover {
  background-color: #094bb5;
}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.modal {
      display: none;
      position: fixed;
      z-index: 1000;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      padding: 20px;
      text-align: center;
      overflow-y: auto;
    }

    .modal:before {
      content: '';
      display: inline-block;
      height: 100%;
      vertical-align: middle;
      margin-right: -4px;
    }

    .modal-content {
      direction: rtl;
      background-color: #ffffff;
      border-radius: 15px;
      padding: 25px;
      width: 90%;
      max-width: 500px;
      position: relative;
      text-align: right;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      animation: fadeIn 0.4s ease-in-out;
      display: inline-block;
      margin: 20px auto;
      vertical-align: middle;
      box-sizing: border-box; 
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
.modal-content h2 {
  color: #2f75e7;
  text-align: center;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
  font-size: 1.5rem;
}

.modal-content input,
.modal-content select {
  width: 100%;
  padding: 12px 15px;
  margin-bottom: 15px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 1rem;
  background-color: #f8fafc;
  transition: all 0.3s;
  box-sizing: border-box;
}

.modal-content input:focus,
.modal-content select:focus {
  border-color: #2f75e7;
  outline: none;
  box-shadow: 0 0 0 3px rgba(47, 117, 231, 0.1);
}

.modal-content button {
  background-color: #2f75e7;
  color: white;
  border: none;
  padding: 12px 25px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 500;
  transition: all 0.3s;
  width: 100%;
  margin-top: 10px;
}

.modal-content button:hover {
  background-color: #1e5fd9;
}

.close {
  position: absolute;
  top: 15px;
  left: 15px;
  font-size: 24px;
  color: #888;
  cursor: pointer;
  transition: all 0.3s;
}

.close:hover {
  color: #2f75e7;
  transform: scale(1.1);
}
.request-card {
  background-color: #ffffff;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 15px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  border-right: 4px solid #2f75e7;
  transition: all 0.3s ease;
}

.request-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.request-card p {
  margin: 8px 0;
  color: #333;
  font-size: 15px;
}

.request-card strong {
  color: #2f75e7;
  font-weight: 600;
}

.request-actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}

.request-actions button {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
}

.request-actions button:first-child {
  background-color: #4CAF50;
  color: white;
}

.request-actions button:first-child:hover {
  background-color: #3e8e41;
}

.request-actions button:last-child {
  background-color: #f44336;
  color: white;
}

.request-actions button:last-child:hover {
  background-color: #d32f2f;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¹Ù†ÙˆØ§Ù† */
#requestsModal h2 {
  color: #2f75e7;
  text-align: center;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
}
/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù…ÙˆØ¯Ø§Ù„ */


  </style>
</head>
<body>

<!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
<nav class="sidebar">
  <a href="index.html" class="nav-item">
    <i class="fas fa-home"></i>
    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
  </a>
  <a href="admin.html" class="nav-item" data-page="dashboard">
    <i class="fas fa-user-injured"></i>
    <span>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</span>
  </a>
  <a href="permissions.html" class="nav-item active" data-page="permissions">
    <i class="fas fa-user-shield"></i>
    <span>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</span>
  </a>
  <a href="appointments-admin.html" class="nav-item" data-page="manage-appointments">
    <i class="fas fa-calendar-alt"></i>
    <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</span>
  </a>
  <a href="adm-profile.html" class="nav-item" data-page="profile">
    <i class="fas fa-user"></i>
    <span>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
  </a>
  <a href="logout.html" class="nav-item" data-page="logout">
    <i class="fas fa-sign-out-alt"></i>
    <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
  </a>
</nav>

<div class="container">
  <div class="action-section">
    <div class="action-box">
      <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</h3>
      <div class="button-group">
        <button onclick="openModal('addDoctorModal')">Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨â•</button>
        <button onclick="openModal('addStaffModal')">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ùâ•</button>
        <button onclick="openModal('addPatientModal')">Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶â•</button>
      </div>
    </div>
    <div class="action-box">
      <h3>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø£Ø®Ø±Ù‰</h3>
      <div class="button-group">
        <button onclick="openModal('deleteModal')">Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù… âŒ</button>
        <button onclick="openModal('editModal')">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª âœï¸</button>
        <button onclick="openModal('requestsModal')">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ğŸ“¥</button>
      </div>
    </div>
  </div>
</div>

<!-- Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="addDoctorModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" onclick="closeModal('addDoctorModal')">&times;</span>
    <h2>Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨</h2>
    <input id="doctorName" placeholder="Ø§Ù„Ø§Ø³Ù…" />
    <input id="doctorNationalId" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" />
    <input id="doctorEmployeeId" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù" />
    <input id="doctorPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" />
    <input id="doctorEmail" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
    
    <select id="doctorSpecialtySelect" onchange="handleSpecialtyChange('doctorSpecialtySelect','customSpecialtyInput')">
      <option disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>
    </select>
    <input type="text" id="customSpecialtyInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯" style="display: none;">   
    <button id="addDoctorBtn">Ø¥Ø¶Ø§ÙØ©</button>
  </div>
</div>



<div id="addStaffModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('addStaffModal')">&times;</span>
    <h2>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</h2>
    <input placeholder="Ø§Ù„Ø§Ø³Ù…" />
    <input placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" />
    <input placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù" />
    <input placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" />
    <input type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
    <button>Ø¥Ø¶Ø§ÙØ©</button>
  </div>
</div>

<div id="addPatientModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('addPatientModal')">&times;</span>
    <h2>Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶</h2>
    <input placeholder="Ø§Ù„Ø§Ø³Ù…" />
    <input placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" />
    <input placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" />
    <input type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
    <input type="date" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯" />
    <select><option>Ø°ÙƒØ±</option><option>Ø£Ù†Ø«Ù‰</option></select>
    <select>
      <option>A+</option><option>A-</option>
      <option>B+</option><option>B-</option>
      <option>AB+</option><option>AB-</option>
      <option>O+</option><option>O-</option>
    </select>
    <button>Ø¥Ø¶Ø§ÙØ©</button>
  </div>
</div>

<div id="deleteModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('deleteModal')">&times;</span>
    <h2>Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…</h2>
    <input placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" />
    <button>Ø­Ø°Ù</button>
  </div>
</div>

<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('editModal')">&times;</span>
    <h2>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>

    <!-- Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ -->
    <label for="nationalIdInput">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ:</label>
    <input type="text" id="nationalIdInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ" onblur="loadUserByNationalId()">

    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ± -->
    <p id="userRoleLabel" style="font-weight: bold; margin-top: 10px;"></p>

    <!-- Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="editFields" style="display: none; margin-top: 15px;">
      <label for="editName">Ø§Ù„Ø§Ø³Ù…:</label>
      <input type="text" id="editName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">

      <div id="employeeIdSection">
        <label for="editEmployeeId">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</label>
        <input type="text" id="editEmployeeId" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
      </div>

      <label for="editPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
      <input type="text" id="editPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">

      <div id="specialtySection" style="display: none;">
        <label for="specialtySelect">Ø§Ù„ØªØ®ØµØµ:</label>
        <select id="specialtySelect">
          <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª...</option>
        </select>
      </div>
      <input type="text" id="editCustomSpecialty" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯" style="display: none;">

      <label for="editDateInput">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ø£Ùˆ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</label>
      <input type="date" id="editDateInput">
      
      <button onclick="submitUserEdit()" style="margin-top: 15px;">ØªØ¹Ø¯ÙŠÙ„</button>
      <div id="hiddenInputs" style="display:none;">
        <input type="hidden" id="roleSelect">
        <input type="hidden" id="employeeIdInput">
        <input type="hidden" id="nameInput">
        <input type="hidden" id="phoneInput">
        <input type="hidden" id="dateInput">
      </div>
      
    </div>
  </div>
</div>


<div id="requestsModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('requestsModal')">&times;</span>
    <h2>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h2>
    <div id="requestsList">
      <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
    </div>
  </div>

<script type="module">  
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
  import { getDatabase, ref, get, update, remove } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-database.js";
  
  const app = initializeApp({
    apiKey: "AIzaSyCAU6wCvPQwaSBszgfD7PQMgxVw2CyZOK8",
    authDomain: "app-appointment-a2793.firebaseapp.com",
    databaseURL: "https://app-appointment-a2793-default-rtdb.firebaseio.com",
    projectId: "app-appointment-a2793",
    storageBucket: "app-appointment-a2793.appspot.com",
    messagingSenderId: "1015962141540",
    appId: "1:1015962141540:web:70f8a31f3a55e02179f071"
  });
  
  const db = getDatabase(app);
  async function checkNationalIdExists(nationalId) {
    const roles = ["patient", "doctor", "staff"];
    for (const role of roles) {
      const snapshot = await get(ref(db, `users/${role}/${nationalId}`));
      if (snapshot.exists()) return true;
    }
    return false;
  }
  
  // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù…ÙƒØ±Ø± Ø¨ÙŠÙ† Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
  async function checkEmployeeIdExists(employeeId) {
    const [doctorsSnap, staffSnap] = await Promise.all([
      get(ref(db, "users/doctor")),
      get(ref(db, "users/staff"))
    ]);
  
    const checkIn = (snapshot) => {
      if (!snapshot.exists()) return false;
      return Object.values(snapshot.val()).some(user => user.employeeId === employeeId);
    };
  
    return checkIn(doctorsSnap) || checkIn(staffSnap);
  }

  // ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø§Ø¯Ø¦Ø© Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù
  function isValidEmployeePrefix(role, employeeId) {
    const prefixMap = { doctor: "DOC", staff: "STF" };
    return prefixMap[role] ? employeeId.startsWith(prefixMap[role]) : true;
  }

  // Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…ØªØ§Ø­Ø© Ù„Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù…
window.openModal = function(id) {
  const modal = document.getElementById(id);
  if (!modal) return;
  modal.style.display = "block";

  if (id === "addDoctorModal") {
    loadSpecialtiesFromDoctors("doctorSpecialtySelect");
  }
  if (id === 'requestsModal') {
    loadPendingRequests();
  }
};

window.closeModal = function(id) {
  const modal = document.getElementById(id);
  if (modal) modal.style.display = "none";
};

window.clearModalFields = function(modalId) {
  const modal = document.getElementById(modalId);
  if (!modal) return;
  
  const inputs = modal.querySelectorAll("input");
  inputs.forEach(input => {
    input.value = "";
    if (input.type === "text" && input.id.includes("editCustomSpecialty")) {
      input.style.display = "none";
    }
  });

  const selects = modal.querySelectorAll("select");
  selects.forEach(select => {
    select.selectedIndex = 0;
  });
};

window.loadUserByNationalId = async function() {
  const nationalId = document.getElementById("nationalIdInput").value.trim();
  if (!nationalId) return;

  const roles = ["patient", "doctor", "staff"];
  let userData = null;
  let userRole = null;

  for (const role of roles) {
    const snapshot = await get(ref(db, `users/${role}/${nationalId}`));
    if (snapshot.exists()) {
      userData = snapshot.val();
      userRole = role;
      break;
    }
  }

  if (!userData) {
    alert("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
    return;
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
  document.getElementById("editName").value = userData.name || "";
  document.getElementById("editPhone").value = userData.phone || "";
  document.getElementById("editDateInput").value = userData.date || "";
  
  if (userRole === "doctor" || userRole === "staff") {
    document.getElementById("editEmployeeId").value = userData.employeeId || "";
    document.getElementById("employeeIdSection").style.display = "block";
  } else {
    document.getElementById("employeeIdSection").style.display = "none";
  }

  if (userRole === "doctor") {
    document.getElementById("specialtySection").style.display = "block";
    await loadSpecialtiesFromDoctors("specialtySelect", userData.specialization);
  } else {
    document.getElementById("specialtySection").style.display = "none";
  }

  document.getElementById("editFields").style.display = "block";
};
//Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆØ¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
    window.loadSpecialtiesFromDoctors = async function(selectId, selectedSpecialty = "") {
  try {
    const select = document.getElementById(selectId);
    if (!select) return;
    select.innerHTML = '<option value="" disabled selected>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª...</option>';
    
    const snapshot = await get(ref(db, "users/doctor"));
    select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>';
    
    if (snapshot.exists()) {
      const specialties = new Set();
      const doctors = snapshot.val();
      Object.values(doctors).forEach(doc => {
        if (doc.specialization) specialties.add(doc.specialization.trim());
      });
      specialties.forEach(spec => {
        const option = document.createElement("option");
        option.value = spec;
        option.textContent = spec;
        if (spec === selectedSpecialty) {
          option.selected = true;
        }
        select.appendChild(option);
      });
    }

    // Ø®ÙŠØ§Ø± "Ø£Ø®Ø±Ù‰"
    const otherOption = document.createElement("option");
    otherOption.value = "other";
    otherOption.textContent = "Ø£Ø®Ø±Ù‰";
    select.appendChild(otherOption);

    // ØªØ¹ÙŠÙŠÙ† Ø­Ø¯Ø« ØªØºÙŠÙŠØ± Ù„Ø¹Ø±Ø¶ Ø­Ù‚Ù„ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯
    select.addEventListener("change", () => {
      handleSpecialtyChange(selectId, "editCustomSpecialty");
    });

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
    handleSpecialtyChange(selectId, "editCustomSpecialty");

  } catch (error) {
    console.error("Error loading specialties:", error);
    const select = document.getElementById(selectId);
    if (select) select.innerHTML = '<option disabled>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>';
  }
};
  // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± "Ø£Ø®Ø±Ù‰"
 /* window.handleSpecialtyChange = function(selectId, inputId) {
    const select = document.getElementById(selectId);
    const input = document.getElementById(inputId);
    if (!select || !input) return;
    input.style.display = select.value === "other" ? "block" : "none";
  };
*/
  // Ø¯Ø§Ù„Ø© Ù„Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
  /*function clearModalFields(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    modal.querySelectorAll("input").forEach(input => input.value = "");
    modal.querySelector("select").value = "";
    document.getElementById("customSpecialtyInput").style.display = "none";
  }*/

  // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø©
  window.approveUser = async function(role, nationalId) {
    const userRef = ref(db, `users/${role}/${nationalId}`);
    try {
      await update(userRef, {
        status: "active"
      });
      alert("âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
      loadPendingRequests();
    } catch (e) {
      console.error(e);
      alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨");
    }
  };

  window.rejectUser = async function(role, nationalId) {
    const confirmed = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§.");
    if (!confirmed) return;

    try {
      await remove(ref(db, `users/${role}/${nationalId}`));
      alert("ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
      loadPendingRequests();
    } catch (e) {
      console.error(e);
      alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨");
    }
  };

  window.loadPendingRequests = async function() {
    const roles = ["doctor", "staff", "admin"];
    const container = document.getElementById("requestsList");
    container.innerHTML = '<div class="loading-spinner"></div>';

    try {
      let hasRequests = false;
      
      for (const role of roles) {
        const snapshot = await get(ref(db, `users/${role}`));
        if (snapshot.exists()) {
          const users = snapshot.val();
          for (const id in users) {
            const user = users[id];
            if (user.status === "pending") {
              hasRequests = true;
              const card = document.createElement("div");
              card.className = "request-card";
              card.innerHTML = `
                <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${user.name || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${translateRole(role)}</p>
                <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</strong> ${user.nationalId || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</strong> ${user.employeeId || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</p>
                <div class="request-actions">
                  <button onclick="approveUser('${role}', '${user.nationalId}')">
                    <i class="fas fa-check"></i> Ù…ÙˆØ§ÙÙ‚Ø©
                  </button>
                  <button onclick="rejectUser('${role}', '${user.nationalId}')">
                    <i class="fas fa-times"></i> Ø±ÙØ¶
                  </button>
                </div>
              `;
              container.appendChild(card);
            }
          }
        }
      }
      
      if (!hasRequests) {
        container.innerHTML = '<p class="no-requests">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
      }
      
    } catch (error) {
      container.innerHTML = '<p class="error-message">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>';
      console.error("Error loading requests:", error);
    }
  }


/*  async function loadSpecialties(selectId, selectedSpecialty = "") {
  const select = document.getElementById(selectId);
  if (!select) return;

  select.innerHTML = '<option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª...</option>';
  const snapshot = await get(ref(db, "users/doctor"));
  
  select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>';
  if (!snapshot.exists()) return;

  const specialties = new Set();
  Object.values(snapshot.val()).forEach(doc => {
    if (doc.specialization) specialties.add(doc.specialization.trim());
  });

  specialties.forEach(spec => {
    const option = new Option(spec, spec);
    if (spec === selectedSpecialty) option.selected = true;
    select.add(option);
  });

  select.add(new Option("Ø£Ø®Ø±Ù‰", "other"));
}
*/
// Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø³Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ
window.submitUserEdit = async function() {
  const nationalId = document.getElementById("nationalIdInput").value.trim();
  const newName = document.getElementById("editName").value.trim();
  const newPhone = document.getElementById("editPhone").value.trim();
  const newEmployeeId = document.getElementById("editEmployeeId")?.value.trim() || "";
  const selectedSpecialty = document.getElementById("specialtySelect")?.value;
  const customSpecialty = document.getElementById("editCustomSpecialty")?.value.trim() || "";
  const newDate = document.getElementById("editDateInput").value;

  let specialization = selectedSpecialty === "other" ? customSpecialty : selectedSpecialty;

  if (!newName || !newPhone || !newDate) {
    alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");
    return;
  }

  try {
    const roles = ["patient", "doctor", "staff"];
    let currentRole = null;

    // Ù…Ø¹Ø±ÙØ© Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
    for (const role of roles) {
      const snapshot = await get(ref(db, `users/${role}/${nationalId}`));
      if (snapshot.exists()) {
        currentRole = role;
        break;
      }
    }

    if (!currentRole) {
      alert("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.");
      return;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙƒØ±Ø§Ø± Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù (Ù„Ù„Ø·Ø¨ÙŠØ¨ ÙˆØ§Ù„Ù…ÙˆØ¸Ù ÙÙ‚Ø·)
    if (currentRole === "doctor" || currentRole === "staff") {
      if (!newEmployeeId) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù");
        return;
      }

      const allDoctorsSnap = await get(ref(db, "users/doctor"));
      const allStaffSnap = await get(ref(db, "users/staff"));

      const allDoctors = allDoctorsSnap.exists() ? allDoctorsSnap.val() : {};
      const allStaff = allStaffSnap.exists() ? allStaffSnap.val() : {};

      for (const id in allDoctors) {
        if (allDoctors[id].employeeId === newEmployeeId && id !== nationalId) {
          alert("âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ø·Ø¨ÙŠØ¨ Ø¢Ø®Ø±.");
          return;
        }
      }

      for (const id in allStaff) {
        if (allStaff[id].employeeId === newEmployeeId && id !== nationalId) {
          alert("âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ù…ÙˆØ¸Ù Ø¢Ø®Ø±.");
          return;
        }
      }
    }

    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const updateData = {
      name: newName,
      phone: newPhone,
      date: newDate,
    };

    if (currentRole === "doctor" || currentRole === "staff") {
      updateData.employeeId = newEmployeeId;
    }

    if (currentRole === "doctor") {
      updateData.specialization = specialization;
    }

    await update(ref(db, `users/${currentRole}/${nationalId}`), updateData);

    alert("âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­.");
    document.getElementById("editModal").style.display = "none";
  } catch (error) {
    console.error("Error updating user:", error);
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
  }
};


// ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
function translateRole(role) {
  switch(role) {
    case "doctor": return "Ø·Ø¨ÙŠØ¨";
    case "staff": return "Ù…ÙˆØ¸Ù";
    case "admin": return "Ù…Ø³Ø¤ÙˆÙ„";
    case "patient": return "Ù…Ø±ÙŠØ¶";
    default: return "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
  }
}


// Ø¯Ø§Ù„Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø®Ø§Ù†Ø© Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± "Ø£Ø®Ø±Ù‰"
window.handleSpecialtyChange = function(selectId, inputId) {
  const select = document.getElementById(selectId);
  const input = document.getElementById(inputId);
  
  if (!select || !input) return;
  
  if (select.value === "other") {
    input.style.display = "block";
  } else {
    input.style.display = "none";
  }
};

// --- Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ ---
document.getElementById("addDoctorBtn").addEventListener("click", async () => {
    const name = document.getElementById("doctorName").value.trim();
    const nationalId = document.getElementById("doctorNationalId").value.trim();
    const employeeId = document.getElementById("doctorEmployeeId").value.trim();
    const phone = document.getElementById("doctorPhone").value.trim();
    const email = document.getElementById("doctorEmail").value.trim();
    const specialtySelect = document.getElementById("doctorSpecialtySelect");
    let specialization = specialtySelect.value === "other" ? document.getElementById("customSpecialtyInput").value.trim() : specialtySelect.value;

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
    if (!name || !nationalId || !employeeId || !phone || !email || !specialization) {
      alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.");
      return;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹
    if (await checkNationalIdExists(nationalId)) {
      alert("Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹.");
      return;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø³Ø¨Ù‚Ø§Ù‹
    if (await checkEmployeeIdExists(employeeId)) {
      alert("Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹.");
      return;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø§Ø¯Ø¦Ø© Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù
    if (!isValidEmployeePrefix("doctor", employeeId)) {
      alert("âŒ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ù„Ø·Ø¨ÙŠØ¨ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 'DOC'");
      return;
    }

    try {
      await set(ref(db, `users/doctor/${nationalId}`), {
        name,
        nationalId,
        employeeId,
        phone,
        email,
        password: "az123", // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        specialization,
        role: "doctor",
        status: "active"
      });
      alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø¨Ù†Ø¬Ø§Ø­.");
      clearModalFields("addDoctorModal");
      closeModal("addDoctorModal");
    } catch (e) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©.");
      console.error(e);
    }
  });


  // --- Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù ---
  document.querySelector("#addStaffModal button").addEventListener("click", async () => {
    const modal = document.querySelector("#addStaffModal");
    const name = modal.querySelector("input[placeholder='Ø§Ù„Ø§Ø³Ù…']").value.trim();
    const nationalId = modal.querySelector("input[placeholder='Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©']").value.trim();
    const employeeId = modal.querySelector("input[placeholder='Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù']").value.trim();
    const phone = modal.querySelector("input[placeholder='Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ']").value.trim();
    const email = modal.querySelector("input[placeholder='Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ']").value.trim();

    if (!name || !nationalId || !employeeId || !phone || !email) {
      alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.");
      return;
    }

    if (await checkNationalIdExists(nationalId)) {
      alert("Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹.");
      return;
    }

    if (await checkEmployeeIdExists(employeeId)) {
      alert("Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹.");
      return;
    }
    if (!isValidEmployeePrefix("staff", employeeId)) {
  alert("âŒ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ù„Ù…ÙˆØ¸Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 'STF'");
  return;
}


    try {
      await set(ref(db, `users/staff/${nationalId}`), {
        name,
        nationalId,
        employeeId,
        phone,
        email,
        password:"az123",
        role: "staff",
        status: "active"
      });
      alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­.");
      clearModalFields("addStaffModal");
      closeModal("addStaffModal");
    } catch (e) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©.");
      console.error(e);
    }
  });

  // --- Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶ ---
  document.querySelector("#addPatientModal button").addEventListener("click", async () => {
    const modal = document.querySelector("#addPatientModal");
    const name = modal.querySelector("input[placeholder='Ø§Ù„Ø§Ø³Ù…']").value.trim();
    const nationalId = modal.querySelector("input[placeholder='Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©']").value.trim();
    const phone = modal.querySelector("input[placeholder='Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ']").value.trim();
    const email = modal.querySelector("input[placeholder='Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ']").value.trim();
    const dob = modal.querySelector("input[placeholder='ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯']").value;
    const genderSelect = modal.querySelector("select");
    const gender = genderSelect ? genderSelect.value : null;
    const bloodTypeSelect = modal.querySelectorAll("select")[1];
    const bloodType = bloodTypeSelect ? bloodTypeSelect.value : null;

    if (!name || !nationalId || !phone || !email || !dob || !gender || !bloodType) {
      alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.");
      return;
    }

    if (await checkNationalIdExists(nationalId)) {
      alert("Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹.");
      return;
    }

    try {
      await set(ref(db, `users/patient/${nationalId}`), {
        name,
        nationalId,
        phone,
        email,
        dob,
        gender,
        bloodType,
        password:"az123",
        role: "patient",
        status: "active"
      });
      alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¨Ù†Ø¬Ø§Ø­.");
      clearModalFields("addPatientModal");
      closeModal("addPatientModal");
    } catch (e) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©.");
      console.error(e);
    }
  });

 // --- Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù… ---
document.querySelector("#deleteModal button").addEventListener("click", async () => {
  const modal = document.querySelector("#deleteModal");
  const nationalId = modal.querySelector("input").value.trim();
  if (!nationalId) {
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©.");
    return;
  }

  const confirmed = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ Ø³ÙŠØªÙ… Ù†Ù‚Ù„Ù‡ Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø°ÙˆÙÙŠÙ†.");
  if (!confirmed) return;

  const roles = ["patient", "doctor", "staff"];
  let found = false;

  const deletedBy = localStorage.getItem("adminId") || localStorage.getItem("staffId") || "unknown";
  const deletedAt = new Date().toISOString();

  for (const role of roles) {
    const userRef = ref(db, `users/${role}/${nationalId}`);
    const snap = await get(userRef);
    if (snap.exists()) {
      const userData = snap.val();

      const deletedUserData = {
        ...userData,
        deletedBy,
        deletedAt
      };

      try {
        const deletedRef = ref(db, `deletedUsers/${role}/${nationalId}`);
        await set(deletedRef, deletedUserData);
        await remove(userRef);

        alert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† ${role} ÙˆÙ†Ù‚Ù„Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„.`);
        clearModalFields("deleteModal");
        closeModal("deleteModal");
        found = true;
        break;
      } catch (e) {
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù.");
        console.error(e);
        return;
      }
    }
  }

  if (!found) {
    alert("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….");
  }
});

//Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
/*async function loadPendingRequests() {
  const roles = ["doctor", "staff", "admin"];
  const container = document.getElementById("requestsList");
  container.innerHTML = "";

  for (const role of roles) {
    const snapshot = await get(ref(db, `users/${role}`));
    if (snapshot.exists()) {
      const users = snapshot.val();
      for (const id in users) {
        const user = users[id];
        if (user.status === "pending") {
          const card = document.createElement("div");
          card.className = "request-card";
          card.innerHTML = `
            <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${user.name}</p>
            <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${translateRole(role)}</p>
            <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</strong> ${user.nationalId}</p>
            <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</strong> ${user.employeeId || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</p>
            <div class="request-actions">
              <button onclick="approveUser('${role}', '${user.nationalId}')"><i class="fas fa-check"></i> Ù…ÙˆØ§ÙÙ‚Ø©</button>
              <button onclick="rejectUser('${role}', '${user.nationalId}')"><i class="fas fa-times"></i> Ø±ÙØ¶</button>
            </div>
          `;
          container.appendChild(card);
        }
      }
    }
  }
}*/
// Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³ÙƒØ±Ø¨Øª
document.querySelectorAll('[onclick^="openModal"]').forEach(button => {
  const modalId = button.getAttribute('onclick').match(/openModal\('(.+?)'\)/)[1];
  button.removeAttribute('onclick');
  button.addEventListener('click', () => window.openModal(modalId));
});
</script>  
</body>
</html>
