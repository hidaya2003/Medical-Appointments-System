<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="darkmode.css" />
    <link rel="shortcut icon" href="icon-192.png" type="image/png">
    <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-auth-compat.js"></script>
<style>
        :root {
            --primary-blue: #3b82f6;
            --primary-green: #10b981;
            --primary-red: #ef4444;
            --primary-purple: #8b5cf6;
            --light-gray: #f7f7f7;
            --dark-gray: #334155;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }
        
        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            direction: rtl;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            margin-top: 40px;
        }

#login-content input,
#register-content input,
#login-content input[type="text"],
#login-content input[type="password"],
#register-content input[type="text"],
#register-content input[type="password"],
#register-content input[type="tel"],
#register-content input[type="email"] {
    background-color: #f7f7f7 
}
    
#login-content input:focus,
#register-content input:focus {
    background-color: #f7f7f7 
}
        .auth-container {
            width: 100%;
            max-width: 1200px;
            background: #f7f7f7;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .auth-header {
            background: linear-gradient(135deg, var(--primary-blue), #2563eb);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 15px;
        }
        
        .auth-header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .auth-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px auto 0;
            width: fit-content;
        }
        
        .auth-tab {
            padding: 12px 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .auth-tab.active {
            background: #f7f7f7;
            color: var(--primary-blue);
        }
        
        .auth-content {
            display: none;
            padding: 30px;
        }
        
        .auth-content.active {
            display: block;
            background-color: #f7f7f7;
        }
        
        .role-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .role-card {
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }
        
        .role-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .role-card.selected {
            border-color: transparent;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .role-card.patient {
            background: rgba(16, 185, 129, 0.1);
        }
        
        .role-card.patient.selected {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), #f7f7f7);
            border-color: var(--primary-green);
        }
        
        .role-card.doctor {
            background: rgba(59, 130, 246, 0.1);
        }
        
        .role-card.doctor.selected {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2),#f7f7f7);
            border-color: var(--primary-blue);
        }
        
        .role-card.admin {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .role-card.admin.selected {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2),#f7f7f7);
            border-color: var(--primary-red);
        }
        
        .role-card.staff {
            background: rgba(139, 92, 246, 0.1);
        }
        
        .role-card.staff.selected {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), #f7f7f7);
            border-color: var(--primary-purple);
        }
        
        .role-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .role-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .role-desc {
            color: #64748b;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-group input:focus {
        background-color: #e6f7ff; /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚ÙˆÙ„ */
        border-color: #3b82f6; /* ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
    }
        
        .submit-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 15px;
            background: var(--primary-blue);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .submit-btn:hover {
        background-color: #2563eb;
        transform: translateY(-2px);
        box-shadow: 0 5px 10px rgba(171, 193, 227, 0.4); /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù„ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙˆÙ‚ Ø§Ù„Ø²Ø± */
    }
        
    .switch-text {
    text-align: center;
    margin-top: 20px;
    color: #327cf3;
    font-size: 0.9rem;
    direction: rtl;
    display: block;
}

        
.switch-text a {
    color: var(--primary-blue);
    text-decoration: none;
    font-weight: 500;
    cursor: pointer;
    display: inline-block;
}
.switch-text a:hover {
    text-decoration: underline;
}


        
        @media (max-width: 768px) {
            .auth-header {
                padding: 20px;
            }
            
            .auth-header h1 {
                font-size: 1.8rem;
            }
            
            .auth-tab {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .auth-content {
                padding: 20px;
            }
            
            .role-cards {
                grid-template-columns: 1fr;
            }
        }
        .back-icon {
        width: 50px;
        height: 50px;
        position: fixed;
        top: 20px;
        right:20px;
        cursor: pointer;
        z-index: 1000;
        transition: transform 0.3s ease-in-out;
        }
/* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù†Ø¯ ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø§ÙˆØ³ ÙÙˆÙ‚Ù‡Ø§ */
        .back-icon:hover {
            transform: scale(1.2);
            }
            .form-group select {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    font-size: 1rem;
    background-color: #f7f7f7;
    transition: all 0.3s;
    appearance: none; /* ØªØ®ÙÙŠ Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¨Ø±Ø§ÙˆØ²Ø± ÙˆØªØ®Ù„ÙŠÙ‡ Ø£Ù†Ø¹Ù… */
    -webkit-appearance: none;
    -moz-appearance: none;
}

.form-group select:focus {
    border-color: var(--primary-blue);
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}
    
.modal-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal-overlay.active {
  display: flex;
}

.modal-content {
  background-color: #fff;
  padding: 30px;
  border-radius: 10px;
  width: 350px;
  max-width: 90%;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  text-align: right;
  animation: fadeInScale 0.3s ease forwards;
  margin-right:450px;
  margin-top: 150px;
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

    </style>
</head>
<body>

    <img src="arrow_forward_24dp_4B77D1_FILL0_wght400_GRAD0_opsz24.png" 
        alt="Ø±Ø¬ÙˆØ¹" 
        style="cursor: pointer; width: 40px;" 
        onclick="goBack()"
        class="back-icon">
    
    <div class="auth-container">
        <div class="auth-header">
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchTab('login')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
                <div class="auth-tab" onclick="switchTab('register')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</div>
            </div>
        </div>

        <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="login-content" class="auth-content active">
            <form onsubmit="loginUser(event)">
                <div class="form-group">
                    <label for="login-id"  >Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                    <input type="text" id="login-id" name="loginId" autocomplete="off" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù" />
                </div>

                <div class="form-group">
                    <label for="login-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="login-password" name="loginPass" autocomplete="new-password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" />
                </div>

                <button type="button" class="submit-btn" onclick="loginUser(event)">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <a  class="switch-text" href="javascript:void(0)" onclick="showResetPassword()">Ù‡Ù„ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ</a>

                <!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
                <div id="reset-password-modal" class="modal-overlay">
                  <div class="modal-content">
                    <h3 style="margin-top: 0;">ğŸ”’ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h3>
                    
                    <label for="reset-id">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© / Ø§Ù„Ù…ÙˆØ¸Ù:</label>
                    <input type="text" id="reset-id" style="width: 100%; margin-bottom: 10px;" />
                    
                    <label for="new-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                    <input type="password" id="new-password" style="width: 100%; margin-bottom: 10px;" />
                    
                    <button onclick="resetPassword()" style="width: 100%; background-color: #4CAF50; color: white; padding: 10px; border: none; border-radius: 5px;">ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</button>
                    
                    <button  type="button"  onclick="closeResetPassword()" style="width: 100%; margin-top: 10px; background-color: #ccc; padding: 10px; border: none; border-radius: 5px;">Ø¥Ù„ØºØ§Ø¡</button>
                  </div>
                </div>  
                        
                <div class="switch-text">
                    Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" onclick="switchTab('register'); return false;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
                </div>
            </form> 
        </div>

        <!-- Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ -->
        <div id="register-content" class="auth-content">
            <div class="role-cards">
                <div class="role-card patient" onclick="selectRole('patient')">
                    <div class="role-icon">ğŸ™â€â™‚ï¸</div>
                    <h3 class="role-title">Ù…Ø±ÙŠØ¶</h3>
                    <p class="role-desc">Ø§Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨ ÙƒÙ…Ø±ÙŠØ¶ Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„ØªÙƒ Ø§Ù„ØµØ­ÙŠØ©</p>
                </div>

                <div class="role-card doctor" onclick="selectRole('doctor')">
                    <div class="role-icon">ğŸ‘¨â€âš•ï¸</div>
                    <h3 class="role-title">Ø·Ø¨ÙŠØ¨</h3>
                    <p class="role-desc">Ø§Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨ ÙƒØ·Ø¨ÙŠØ¨ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ù…Ø±Ø¶Ù‰</p>
                </div>

                <div class="role-card admin" onclick="selectRole('admin')">
                    <div class="role-icon">ğŸ‘¨ğŸ’¼</div>
                    <h3 class="role-title">Ù…Ø³Ø¤ÙˆÙ„</h3>
                    <p class="role-desc">Ø§Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨ ÙƒÙ…Ø³Ø¤ÙˆÙ„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
                </div>

                <div class="role-card staff" onclick="selectRole('staff')">
                    <div class="role-icon">ğŸ“</div>
                    <h3 class="role-title">Ù‚Ø³Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
                    <p class="role-desc">Ø§Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨ ÙƒÙ…ÙˆØ¸Ù Ø¥Ø¯Ø§Ø±ÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                </div>
            </div>

            <form id="register-form" style="display:none;" onsubmit="registerUser(event)">
                <input type="hidden" id="user-role" name="role">

                <div class="form-group">
                    <label for="register-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="register-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required>
                </div>

                <div class="form-group">
                    <label for="register-id">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                    <input type="text" id="register-id" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" required>
                </div>

                <div class="form-group" id="employee-id-group" style="display:none;">
                    <label for="register-employee-id">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                    <input type="text" id="register-employee-id" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
                    <small style="color: #64748b; font-size: 0.8rem;">ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 
                        <span id="employee-prefix-hint" style="font-weight: bold;"></span>
                    </small>
                </div>

                <div class="form-group">
                    <label for="register-phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="register-phone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
                </div>

                <div class="form-group">
                    <label for="register-email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="register-email" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                </div>

                <div class="form-group" id="doctor-specialization-group" style="display:none;">
                        <label for="doctor-specialization">ØªØ®ØµØµ Ø§Ù„Ø·Ø¨ÙŠØ¨</label>
                        <select id="doctor-specialization">
                            <option value="">Ø§Ø®ØªØ± ØªØ®ØµØµÙƒ</option>
                            <option value="Ø¬Ø±Ø§Ø­Ø© Ø¹Ø¸Ø§Ù…">Ø¬Ø±Ø§Ø­Ø© Ø¹Ø¸Ø§Ù…</option>
                            <option value="Ø·Ø¨ Ø§Ù„Ø£Ø·ÙØ§Ù„">Ø·Ø¨ Ø§Ù„Ø£Ø·ÙØ§Ù„</option>
                            <option value="Ø·Ø¨ Ø§Ù„Ù‚Ù„Ø¨">Ø·Ø¨ Ø§Ù„Ù‚Ù„Ø¨</option>
                            <option value="Ø§Ù„Ø¬Ù„Ø¯ÙŠØ©">Ø§Ù„Ø¬Ù„Ø¯ÙŠØ©</option>
                            <option value="Ø§Ù„Ø£Ø¹ØµØ§Ø¨">Ø§Ù„Ø£Ø¹ØµØ§Ø¨</option>
                            <option value="Ø·Ø¨ Ø§Ù„Ø¹ÙŠÙˆÙ†">Ø·Ø¨ Ø§Ù„Ø¹ÙŠÙˆÙ†</option>
                            <option value="Ø·Ø¨ Ø§Ù„Ø£Ø³Ù†Ø§Ù†">Ø·Ø¨ Ø§Ù„Ø£Ø³Ù†Ø§Ù†</option>
                            <option value="other">ØªØ®ØµØµÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</option>
                        </select>
                        <input type="text" id="doctor-specialization-other" placeholder="Ø§ÙƒØªØ¨ ØªØ®ØµØµÙƒ Ù‡Ù†Ø§">
                </div>

                <div id="patient-fields" style="display: none;">
                    <div class="form-group">
                        <label for="register-gender">Ø§Ù„Ø¬Ù†Ø³</label>
                        <select id="register-gender" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
                            <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
                            <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
                        </select>
                    </div>
                
                    <div class="form-group">
                        <label for="register-dob">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                        <input type="date" id="register-dob" required>
                    </div>   
                
                    <div class="form-group">
                        <label for="register-blood">ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…</label>
                        <select id="register-blood" required>
                            <option value="">Ø§Ø®ØªØ± ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                
                    <div class="form-group">
                        <label for="register-allergy">Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ù…Ø§Ø¯Ø© Ù…Ø§ØŸ</label>
                        <input type="text" id="register-allergy" placeholder="Ø§Ø°ÙƒØ± Ø§Ù„Ù…Ø§Ø¯Ø© Ø£Ùˆ Ø§ÙƒØªØ¨ (Ù„Ø§)">
                    </div>
                </div>


                <div id="common-location-fields" class="form-row" style="display: none; gap: 10px; flex-wrap: wrap;">
                  <div class="form-group" style="flex: 1;">
                    <label for="register-common-city">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                    <select id="register-common-city">
                      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                      <option value="Ø±Ø§Ù… Ø§Ù„Ù„Ù‡">Ø±Ø§Ù… Ø§Ù„Ù„Ù‡</option>
                      <option value="Ù†Ø§Ø¨Ù„Ø³">Ù†Ø§Ø¨Ù„Ø³</option>
                      <option value="Ø§Ù„Ø®Ù„ÙŠÙ„">Ø§Ù„Ø®Ù„ÙŠÙ„</option>
                      <option value="Ø¬Ù†ÙŠÙ†">Ø¬Ù†ÙŠÙ†</option>
                      <option value="Ø·ÙˆÙ„ÙƒØ±Ù…">Ø·ÙˆÙ„ÙƒØ±Ù…</option>
                      <option value="Ù‚Ù„Ù‚ÙŠÙ„ÙŠØ©">Ù‚Ù„Ù‚ÙŠÙ„ÙŠØ©</option>
                      <option value="Ø¨ÙŠØª Ù„Ø­Ù…">Ø¨ÙŠØª Ù„Ø­Ù…</option>
                      <option value="Ø³Ù„ÙÙŠØª">Ø³Ù„ÙÙŠØª</option>
                      <option value="Ø£Ø±ÙŠØ­Ø§">Ø£Ø±ÙŠØ­Ø§</option>
                      <option value="Ø·ÙˆØ¨Ø§Ø³">Ø·ÙˆØ¨Ø§Ø³</option>
                    </select>
                  </div>
                
                  <div class="form-group" style="flex: 1;">
                    <label for="register-common-town">Ø§Ù„Ù‚Ø±ÙŠØ© / Ø§Ù„Ø¨Ù„Ø¯Ø©</label>
                    <input type="text" id="register-common-town" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø±ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¨Ù„Ø¯Ø©">
                  </div>
                </div>
                


                <div class="form-group">
                    <label for="register-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="register-password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                </div>

                <div class="form-group">
                    <label for="register-confirm-password">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="register-confirm-password" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                </div>

                <button type="submit" class="submit-btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>

                <div class="switch-text">
                    Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="#" onclick="switchTab('login'); return false;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                </div>
            </form>
        </div>
    </div>

  <script>
        function goBack() {
                     window.location.href = "index.html";
                }
        </script>
<script type="module">
    /* ========== 1) Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ========== */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
    import {
      getDatabase,
      ref,
      get,
      set
    } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-database.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyCAU6wCvPQwaSBszgfD7PQMgxVw2CyZOK8",
      authDomain: "app-appointment-a2793.firebaseapp.com",
      databaseURL: "https://app-appointment-a2793-default-rtdb.firebaseio.com",
      projectId: "app-appointment-a2793",
      storageBucket: "app-appointment-a2793.appspot.com",
      messagingSenderId: "1015962141540",
      appId: "1:1015962141540:web:70f8a31f3a55e02179f071"
    };
  
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
  
    window.addEventListener('DOMContentLoaded', () => {
  const specializationSelect = document.getElementById('doctor-specialization');
  const specializationOtherInput = document.getElementById('doctor-specialization-other');

  // Ù†Ø®ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ø¢Ø®Ø± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
  specializationOtherInput.style.display = 'none';

  // Ø§Ø³ØªÙ…Ø¹ Ù„ØªØºÙŠÙŠØ± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ®ØµØµ
  specializationSelect.addEventListener('change', () => {
    if (specializationSelect.value === 'other') {
      specializationOtherInput.style.display = 'block'; 
    } else {
      specializationOtherInput.style.display = 'none';  
      specializationOtherInput.value = '';              
    }
  });
});

   /*  2) ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯  */
window.registerUser = async function (event) {
  event.preventDefault();

  const role = getValue('user-role');
  const name = getValue('register-name');
  const nationalId = getValue('register-id');
  const employeeId = getValue('register-employee-id');
  const phone = getValue('register-phone');
  const email = getValue('register-email');
  const commonCity = getValue('register-common-city');
  const commonTown = getValue('register-common-town');
  const password = getValue('register-password');
  const confirmPass = getValue('register-confirm-password');
  const specializationSelect = getValue('doctor-specialization');
const specializationOther = getValue('doctor-specialization-other');

let specialization = "";

if (specializationSelect === "other") {
  specialization = specializationOther.trim();
  if (!specialization) {
    alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© ØªØ®ØµØµ Ø§Ù„Ø·Ø¨ÙŠØ¨");
    return;
  }
} else {
  specialization = specializationSelect;
}

  if (!role || !name || !nationalId || !phone || !password || !confirmPass || !commonCity || !commonTown) {
    alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©");
    return;
  }

  if (password !== confirmPass) {
    alert("âŒ ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†");
    return;
  }

  if (role !== 'patient') {
    if (!email) {
      alert("âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¥Ù„Ø²Ø§Ù…ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†");
      return;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      alert("âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­");
      return;
    }
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
  const prefixMap = { admin: "ADM", staff: "STF", doctor: "DOC" };
  const expectedPrefix = prefixMap[role] || null;

  if (expectedPrefix) {
    if (!employeeId || !employeeId.startsWith(expectedPrefix)) {
      alert(`âŒ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø·Ù„ÙˆØ¨ ÙˆÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ ${expectedPrefix}`);
      return;
    }
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶
  let patientData = {};
  if (role === 'patient') {
    const gender = getValue('register-gender');
    const dob = getValue('register-dob');
    const city = getValue('register-common-city');
    const town = getValue('register-common-town');
    const blood = getValue('register-blood');
    const allergy = getValue('register-allergy');

    if (!gender || !dob || !city || !town || !blood || !allergy) {
      alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶");
      return;
    }

    patientData = {
      gender,
      dob,
      city,
      town,
      bloodType: blood,
      allergy
    };
  }
  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  const userData = {
    role,
    name,
    nationalId,
    employeeId: expectedPrefix ? employeeId : "",
    phone,
    email: email || "", 
    password,
    ...patientData,
    specialization: role === 'doctor' ? specialization : "",
    city: role === 'patient' ? patientData.city : commonCity,
    town: role === 'patient' ? patientData.town : commonTown,
     status: (role === 'doctor' || role === 'staff'||role ==='admin') ? "pending" : "active",
  };

  const userRefPath = `users/${role}/${nationalId}`;

  try {
    const userRef = ref(database, userRefPath);
    const exists = (await get(userRef)).exists();

    if (exists) {
      alert("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù‘Ù„ Ù…Ø³Ø¨Ù‚Ù‹Ø§");
      return;
    }

    await set(userRef, userData);

    localStorage.setItem('nationalId', nationalId);

    if (role === 'doctor' || role === 'staff' ||role ==='admin') {
      alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ÙƒØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.");
    } else {
      alert("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­.");
    }
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø®Ø§ØµØ©
    document.getElementById("register-form").reset();
    document.getElementById("register-form").style.display = "none";
    document.getElementById("employee-id-group").style.display = "none";
    document.getElementById("doctor-specialization-group").style.display = "none";
    switchTab("login");

  } catch (err) {
    alert("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + err.message);
  }
};

/*  3) ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„  */
window.loginUser = async function (event) {
  event.preventDefault();

  const idInput = getValue('login-id');
  const passInput = getValue('login-password');

  if (!idInput || !passInput) {
    alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
    return;
  }

  const roles = ['admin', 'staff', 'doctor', 'patient'];
  let found = false;
  let userData = null;
  let matchedRole = null;

  try {
    for (let role of roles) {
      const roleRef = ref(database, `users/${role}`);
      const snapshot = await get(roleRef);

      if (snapshot.exists()) {
        const users = snapshot.val();

        for (let userKey in users) {
          const user = users[userKey];

          if (role === 'patient') {
            if (userKey === idInput && user.password === passInput) {
              userData = user;
              matchedRole = role;
              found = true;
              break;
            }
          } else {
            if (user.employeeId === idInput && user.password === passInput) {
              if (user.status !== 'active') {
                alert("âš ï¸ Ø­Ø³Ø§Ø¨Ùƒ Ù„Ù… ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„.");
                return;
              }
              userData = user;
              matchedRole = role;
              found = true;
              break;
            }
          }
        }


        if (found) break;
      }
    }

    if (found && userData) {
  alert(`âœ… Ø£Ù‡Ù„Ø§Ù‹ ${userData.name}`);
  localStorage.clear();

  localStorage.setItem('userRole', matchedRole);
  localStorage.setItem('nationalId', userData.nationalId); // Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ù„Ù„Ø¬Ù…ÙŠØ¹

  if (matchedRole !== 'patient') {
    localStorage.setItem('employeeId', userData.employeeId); // Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙ‚Ø·
  }

  const now = new Date();
  const formattedLogin = now.toLocaleDateString('ar-EG') + " " + now.toLocaleTimeString('ar-EG');
  localStorage.setItem("lastLogin", formattedLogin);

      if (matchedRole === 'patient') {
        localStorage.setItem('patientId', idInput);
        localStorage.setItem('patientName', userData.name);
        window.location.href = 'patient.html';
      } else if (matchedRole === 'doctor') {
        localStorage.setItem('doctorData', JSON.stringify({
          name: userData.name,
          specialization: userData.specialization || "",
          employeeId: userData.employeeId,
          nationalId: userData.nationalId
        }));
        localStorage.setItem('doctorName', userData.name);
        window.location.href = 'doctor.html';
      } else if (matchedRole === 'staff') {
        console.log("Logged in Staff User:", userData);
        localStorage.setItem('staffName', userData.name);
        localStorage.setItem('staffId', userData.nationalId);
        window.location.href = 'staff.html';
      } else if (matchedRole === 'admin') {
        localStorage.setItem('adminId', userData.nationalId);
        window.location.href = 'admin.html';
      }

    } else {
      alert("âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©/Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©");
    }
  } catch (err) {
    alert("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + err.message);
  }
};

window.onload = () => {
  const modal = document.getElementById('reset-password-modal');
  modal.classList.remove('active');
  modal.style.display = 'none'; // ÙÙ‚Ø· Ù„Ùˆ ØªÙ… Ø¹Ø±Ø¶Ù‡ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø®Ø§Ø·Ø¦Ø© Ø³Ø§Ø¨Ù‚Ù‹Ø§
};
  
/*  4) Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±  */
window.showResetPassword = function () {
  const modal = document.getElementById("reset-password-modal");
  modal.style.display = "block";        
  modal.classList.add("active");         
};


window.closeResetPassword = function () {
  const modal = document.getElementById("reset-password-modal");
  modal.classList.remove("active");
  modal.style.display = "none";         
};

window.resetPassword = async function () {
  const userId = getValue("reset-id"); 
  const newPass = getValue("new-password");

  if (!userId || !newPass) {
    alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
    return;
  }

  if (newPass.length < 6) {
    alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 6 Ø£Ø­Ø±Ù");
    return;
  }

  const roles = ['admin', 'staff', 'doctor', 'patient'];
  let found = false;

  for (let role of roles) {
    const userRef = ref(database, `users/${role}/${userId}`);
    const snapshot = await get(userRef);

    if (snapshot.exists()) {
      const targetRef = ref(database, `users/${role}/${userId}/password`);
      await set(targetRef, newPass);
      found = true;
      break;
    }
  }

  if (found) {
    alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­");
    document.getElementById("reset-id").value = "";
    document.getElementById("new-password").value = "";
    closeResetPassword();
  } else {
    alert("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
  }
};

    /*  5) Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©  */
    function getValue(id) {
      return document.getElementById(id)?.value?.trim() || '';
    }
  
    window.switchTab = function (tab) {
      const loginTab = document.querySelector('.auth-tab:nth-child(1)');
      const registerTab = document.querySelector('.auth-tab:nth-child(2)');
      const loginContent = document.getElementById('login-content');
      const registerContent = document.getElementById('register-content');
  
      loginTab.classList.toggle('active', tab === 'login');
      registerTab.classList.toggle('active', tab === 'register');
      loginContent.classList.toggle('active', tab === 'login');
      registerContent.classList.toggle('active', tab === 'register');
    };
  
    window.selectRole = function (role) {
  // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
  document.getElementById("register-form").style.display = "block";
  document.getElementById("register-form").reset();
  document.getElementById("user-role").value = role;

  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø¯Ø¦Ø© Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù
  const prefixMap = { admin: "ADM", staff: "STF", doctor: "DOC" };
  const need = prefixMap[role] || "";
  document.getElementById("employee-id-group").style.display = need ? "block" : "none";
  document.getElementById("employee-prefix-hint").textContent = need;

  // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ ØªØ®ØµØµ Ø§Ù„Ø·Ø¨ÙŠØ¨
  document.getElementById("doctor-specialization-group").style.display = role === "doctor" ? "block" : "none";

  // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø±ÙŠØ¶ ÙˆØªØ¹Ø·ÙŠÙ„Ù‡Ø§ Ù„ØºÙŠØ± Ø§Ù„Ù…Ø±ÙŠØ¶
  const pf = document.getElementById("patient-fields");
  const ctrls = pf.querySelectorAll("input,select");
  pf.style.display = role === "patient" ? "block" : "none";
  ctrls.forEach(el => el.disabled = role !== "patient");

  // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ù„ØºÙŠØ± Ø§Ù„Ù…Ø±ÙŠØ¶
  document.getElementById('common-location-fields').style.display = 'flex';
};

window.checkLoggedIn = function () {
  const role = localStorage.getItem("userRole");
  const nationalId = localStorage.getItem("nationalId");

  if (role && nationalId) {
    alert(`Ù…Ø±Ø­Ø¨Ù‹Ø§ back! Ø¯ÙˆØ±Ùƒ: ${role}`);
  } else {
    alert("âŒ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
  }
};
  </script>    
  <script src="darkMode.js"></script>
</body>
</html>